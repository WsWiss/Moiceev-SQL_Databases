<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ –∏ –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤</title>
    <style>
        /* –≤–µ—Å—å —Å—Ç–∏–ª—å ‚Äì 1-–≤-1 –∏–∑ –≤–∞—à–µ–≥–æ http-hello-html.js */
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;
             background:linear-gradient(135deg,#060609 0%,#ff1493 100%);
             color:#fff;min-height:100vh;padding:20px}
        .container{max-width:1400px;margin:0 auto}
        .header{text-align:center;margin-bottom:30px}
        .header h1{font-size:2.5em;margin-bottom:10px;text-shadow:2px 2px 4px rgba(0,0,0,.3)}
        .header p{font-size:1.2em;opacity:.9}
        .section{background:#fff;color:#000;border-radius:15px;padding:25px;margin-bottom:30px;
                 box-shadow:0 10px 30px rgba(0,0,0,.2);transition:transform .3s}
        .section:hover{transform:translateY(-5px)}
        .section-title{color:#000;border-bottom:3px solid #060609;padding-bottom:10px;margin-bottom:20px;font-size:1.8em}
        .stats{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px;margin-bottom:20px}
        .stat-card{background:linear-gradient(135deg,#060609,#ff1493);color:#fff;padding:20px;border-radius:10px;text-align:center}
        .stat-number{font-size:2em;font-weight:bold;margin-bottom:5px}
        .stat-label{font-size:.9em;opacity:.9}
        table{width:100%;border-collapse:collapse;margin-top:15px;background:#fff;border-radius:10px;overflow:hidden;box-shadow:0 5px 15px rgba(0,0,0,.1)}
        th{background:linear-gradient(135deg,#060609,#ff1493);color:#fff;padding:15px;text-align:left;font-weight:600;text-transform:uppercase;letter-spacing:.5px}
        td{padding:12px 15px;border-bottom:1px solid #e2e8f0}
        tr:hover{background:#f7fafc;transform:scale(1.01);transition:all .2s ease}
        .category-badge{background:#edf2f7;color:#4a5568;padding:4px 8px;border-radius:20px;font-size:.8em;font-weight:500}
        .price{font-weight:bold;color:#2d3748}
        .amount{text-align:center;font-weight:600}
        .filter-box{display:flex;gap:10px;margin-bottom:20px}
        .filter-input{flex:1;padding:10px 14px;border-radius:8px;border:1px solid #ccc;font-size:1rem}
        .filter-btn{padding:10px 20px;border:none;border-radius:8px;background:#ff1493;color:#fff;font-size:1rem;cursor:pointer}
        .filter-btn:hover{background:#e01384}
        .highlight{background-color:#ffeb3b;color:#000;padding:2px 4px;border-radius:3px;font-weight:bold}
        @media(max-width:768px){.header h1{font-size:2em}th,td{padding:8px 10px;font-size:.9em}}
    </style>
</head>
<body>

    
<div class="container">
    <div class="header">
        <h1>üè™ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ –∏ –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤</h1>
        <p>–ü–æ–ª–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–æ–≤–∞—Ä–∞—Ö –∏ –∫–æ–º–ø–∞–Ω–∏—è—Ö-–ø–æ—Å—Ç–∞–≤—â–∏–∫–∞—Ö</p>
    </div>

    <!-- –°–ï–ö–¶–ò–Ø –ü–û–°–¢–ê–í–©–ò–ö–ò -->
    <div class="section">
    <h2 class="section-title">üìä –ü–æ—Å—Ç–∞–≤—â–∏–∫–∏</h2>
    
    <!-- –ü–æ–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞ –¥–ª—è –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ -->
    <div class="filter-box">
        <input id="supplierFilter" class="filter-input" type="text" placeholder="–ü–æ–∏—Å–∫ –ø–æ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞–º..." />
        <button class="filter-btn" onclick="loadSuppliers()">–ü–æ–∏—Å–∫</button>
    </div>
    
    <div class="stats" id="supStats"></div>
    <table id="supTable">
        <thead>
        <tr><th>ID</th><th>–ö–æ–º–ø–∞–Ω–∏—è</th><th>–î–∏—Ä–µ–∫—Ç–æ—Ä</th><th>–¢–µ–ª–µ—Ñ–æ–Ω</th><th>Email</th></tr>
        </thead>
        <tbody></tbody>
    </table>
    </div>

    <!-- –°–µ–∫—Ü–∏—è —Ç–æ–≤–∞—Ä–æ–≤ —Å —Ñ–∏–ª—å—Ç—Ä–æ–º -->
    <div class="section">
        <h2 class="section-title">üì¶ –¢–æ–≤–∞—Ä—ã</h2>

        <!-- –ü–æ–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞ –¥–ª—è —Ç–æ–≤–∞—Ä–æ–≤ -->
        <div class="filter-box">
            <input id="productFilter" class="filter-input" type="text" placeholder="–ü–æ–∏—Å–∫ –ø–æ —Ç–æ–≤–∞—Ä–∞–º..." />
            <button class="filter-btn" onclick="loadProducts()">–ü–æ–∏—Å–∫</button>
        </div>

        <!-- –°—Ç–∞—Ç-–∫–∞—Ä—Ç–æ—á–∫–∏ -->
        <div class="stats" id="stats"></div>

        <!-- –¢–∞–±–ª–∏—Ü–∞ —Ç–æ–≤–∞—Ä–æ–≤ -->
        <table id="productsTable">
            <thead>
            <tr>
                <th>ID</th><th>–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ</th><th>–ü–æ—Å—Ç–∞–≤—â–∏–∫</th><th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th><th>–¶–µ–Ω–∞</th><th>–ö–æ–ª-–≤–æ</th>
            </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
</div>

<script>
/* ---------- –§—É–Ω–∫—Ü–∏—è –ø–æ–¥—Å–≤–µ—Ç–∫–∏ —Ç–µ–∫—Å—Ç–∞ ---------- */
function highlightText(text, searchTerm) {
  if (!searchTerm || !text) return text;
  const regex = new RegExp(`(${searchTerm.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})`, 'gi');
  return text.toString().replace(regex, '<span class="highlight">$1</span>');
}

/* ---------- –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ ---------- */
async function loadSuppliers(){
  const filter = document.getElementById('supplierFilter').value.trim();

  const supRes = await fetch('/api/suppliers'+(filter? '?filter='+encodeURIComponent(filter):''));
  const supData = await supRes.json();
  
  document.getElementById('supStats').innerHTML=`
    <div class="stat-card"><div class="stat-number">${supData.length}</div><div class="stat-label">–í—Å–µ–≥–æ –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤</div></div>
    <div class="stat-card"><div class="stat-number">${new Set(supData.map(s=>s.companyName)).size}</div><div class="stat-label">–£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∫–æ–º–ø–∞–Ω–∏–π</div></div>`;
  
  const supBody = document.querySelector('#supTable tbody');
  supBody.innerHTML = supData.map(s=>`
    <tr>
      <td>${s.id}</td>
      <td><strong>${highlightText(s.companyName, filter)}</strong></td>
      <td>${highlightText(s.directorName, filter)}</td>
      <td>${highlightText(s.directorPhone, filter)}</td>
      <td><a href="mailto:${s.directorEmail}">${highlightText(s.directorEmail, filter)}</a></td>
    </tr>`).join('');
}

/* ---------- –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ ---------- */
async function loadProducts(){
  const filter = document.getElementById('productFilter').value.trim();

  const prodRes = await fetch('/api/products'+(filter? '?filter='+encodeURIComponent(filter):''));
  const prodData = await prodRes.json();
  
  /* —Å—Ç–∞—Ç-–∫–∞—Ä—Ç–æ—á–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤ */
  const totalCost = prodData.reduce((s,p)=>s+(p.cost*p.amount),0);
  document.getElementById('stats').innerHTML=`
    <div class="stat-card"><div class="stat-number">${prodData.length}</div><div class="stat-label">–í—Å–µ–≥–æ —Ç–æ–≤–∞—Ä–æ–≤</div></div>
    <div class="stat-card"><div class="stat-number">${new Set(prodData.map(p=>p.category)).size}</div><div class="stat-label">–ö–∞—Ç–µ–≥–æ—Ä–∏–π</div></div>
    <div class="stat-card"><div class="stat-number">${new Intl.NumberFormat('ru-RU').format(totalCost)} ‚ÇΩ</div><div class="stat-label">–û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å</div></div>
    <div class="stat-card"><div class="stat-number">${prodData.reduce((s,p)=>s+p.amount,0)}</div><div class="stat-label">–û–±—â–µ–µ –∫–æ–ª-–≤–æ</div></div>`;
  
  const prodBody = document.querySelector('#productsTable tbody');
  prodBody.innerHTML = prodData.map(p=>`
    <tr>
      <td>${p.id}</td>
      <td><strong>${highlightText(p.name, filter)}</strong></td>
      <td>${highlightText(p.supplier, filter)}</td>
      <td><span class="category-badge">${highlightText(p.category, filter)}</span></td>
      <td class="price">${highlightText(new Intl.NumberFormat('ru-RU').format(p.cost) + ' ‚ÇΩ', filter)}</td>
      <td class="amount">${highlightText(p.amount, filter)}</td>
    </tr>`).join('');
}

/* ---------- –ü–æ–∏—Å–∫ –ø–æ Enter ---------- */
document.getElementById('supplierFilter').addEventListener('keypress', function(e) {
  if (e.key === 'Enter') loadSuppliers();
});

document.getElementById('productFilter').addEventListener('keypress', function(e) {
  if (e.key === 'Enter') loadProducts();
});

/* ---------- –°—Ç–∞—Ä—Ç–æ–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ ---------- */
loadSuppliers();
loadProducts();
</script>
</body>
</html>